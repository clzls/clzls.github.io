<!DOCTYPE html>
<html lang="zh">

<head>
  <title>运转大数据 | 票机记录生成表</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.13.1/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.13.1/css/solid.min.css">
  <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
  <script src="./js/tkt_type.min.js"></script>
  <style>
    body {padding-top: 4em;}img.ptimg{width:300px;max-width:100%;height:auto}span.s0lt1,span.s1lt1{color:red!important}span.s1lt2,span.s2lt1,span.s2lt2,span.s3lt1,span.s4lt2{color:#ff0!important}span.s4lt1,span.s5lt1{color:#3f3!important}span.s0lt2,span.s3lt2,span.s5lt2{color:transparent!important}
  </style>
</head>

<body>
  <a id="top"></a>
  <nav class="navbar navbar-expand-sm fixed-top navbar-light" style="background-color: #e3f2fd;">
    <a class="navbar-brand" href="./tktmach_latest.html">运转大数据</a>
    <span class="navbar-text"> By Kina(木菜)</span>
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="#">生成器</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="./tktAbout.html">关于</a>
      </li>
    </ul>
  </nav>
  <div class="container">
    项目网址：
    <a href="https://kinarail.gitee.io/ticket_stat/tktmach_latest.html">
      https://kinarail.gitee.io/ticket_stat/tktmach_latest.html
    </a>
    <p></p>
    <div class="container">
      <h4>票机评价标准：</h4>
      <ol class="list-group">
        <li class="list-group-item list-group-item-danger">0分/极差：刚出票即有瑕疵，半年左右即模糊不清，并有缺失、白条等。</li>
        <li class="list-group-item list-group-item-warning">1分/很差：一年左右即模糊不清，缺失、白条等。</li>
        <li class="list-group-item list-group-item-warning">2分/略差：略有模糊，略有不整齐；或两年后褪色明显的。</li>
        <li class="list-group-item list-group-item-info">3分/尚可：半年左右仍清晰可认，无白条。两年后应仍可明显辨认。</li>
        <li class="list-group-item list-group-item-success">4分/佳：一年仍清晰锐利，无白条、缺失。</li>
        <li class="list-group-item list-group-item-success">5分/佳：两年仍清晰锐利，无白条、缺失等。（特殊等级）</li>
        <li class="list-group-item">红色软质车票由于其抗褪色特性，可以视情况加分。（系统自动完成）</li>
      </ol>
    </div>
    <p></p>
    票号前十位包含以下信息：
    <p>5位车站号+2位售票方式号+3位售票窗口号</p>
    <p>售票机的窗口号可以从屏幕最底下获得。售票窗口的窗口号一般悬挂在窗口上，除非有特殊声明。</p>
  </div>
  <script>
    var today = new Date();
    today = today.toISOString().split('T')[0];
    $(document).ready(function () {
      preset_date();
      $("#staname1").change(function () {
        var t = $("#staname1").val();
        if (t.length > 0) {
          $("#descSelTxt_pmbz").prop("placeholder", t + " 售");
          $("#descSelTxt_pmbz").attr("placeholder", t + " 售");
        }
      });
      $("#staname2").change(function () {
        var t = $("#staname2").prop("placeholder");
        if ((t.length > 0) && ($("#staname2").val().length==0)) {
          $("#staname2").val(t);
        }
      });
      $("#tktno").change(function () {
        var t = parseInt($("#tktno").val()) % 100000;
        if (t > 0) {
          var msg = (t >= 30000)?((t/1000%100).toFixed().toString()+"-"+(t%1000).toFixed().toString()+"号?取票机"):((t < 10000)?((t%1000).toFixed().toString()+"号?窗口"):"");
          $("#staname2").prop("placeholder", msg);
          if ((msg.length>0) && ($("#staname2").val().length==0)) $("#staname2").val(msg);
        }
      });
      $("#descSelTxt_pmbz").change(function () {
        $('#descSel_pmbz').prop('checked', Boolean($("#descSelTxt_pmbz").val()));
      });
      $("#sel1").click(function () {
        var t = to_bool($('#sel1').val());
        var k = $('#sel4').children();
        if (t === null)
          k.attr('disabled', false);
        else
          for (var i = 0; i < k.length; ++i) {
            var tp = $(k[i]);
            var tpv = parseInt(tp.attr('data-red'));
            if (tpv == 0) //blue
              tp.attr('disabled', t);
            else if (tpv == 1) //red
              tp.attr('disabled', !t);
            else
              tp.attr('disabled', false);
          }
      });
      $("#sel1").click();
      $("#sel4").change(function () {
        $('#paper_example').fadeOut('fast', function () {
          sub_tkt(parseInt($("#sel4").val()));
        });
      });
    });
    var txt = ["极差", "很差", "略差", "尚可", "佳"];
    function to_bool(val) {
      var p = eval(val);
      if (typeof (p) != "boolean") p = null;
      return p;
    }
    function genFuncCode() {
      var a11 = $('#sel_11').prop("checked");var a12 = $('#sel_12').prop("checked");
      var a21 = $('#sel_21').prop("checked");var a22 = $('#sel_22').prop("checked");
      var a31 = $('#sel_31').prop("checked");var a32 = $('#sel_32').prop("checked");
      var a41 = $('#sel_41').prop("checked");var a42 = $('#sel_42').prop("checked");
      var a51 = $('#sel_51').prop("checked");var a52 = $('#sel_52').prop("checked");
      var a61 = $('#sel_61').prop("checked");var a62 = $('#sel_62').prop("checked");
      var a71 = $('#sel_71').prop("checked");var a72 = $('#sel_72').prop("checked");
      var a81 = $('#sel_81').prop("checked");var a82 = $('#sel_82').prop("checked");
      var a91 = $('#sel_91').prop("checked");var a92 = $('#sel_92').prop("checked");
      var a101 = $('#sel_101').prop("checked");var a102 = $('#sel_102').prop("checked");
      var a111 = $('#sel_111').prop("checked");var a112 = $('#sel_112').prop("checked");
      var a121 = $('#sel_121').prop("checked");var a122 = $('#sel_122').prop("checked");
      var a131 = $('#sel_131').prop("checked");var a132 = $('#sel_132').prop("checked");
      var a141 = $('#sel_141').prop("checked");var a142 = $('#sel_142').prop("checked");
      return (a11?1:0)|(a12?2:0)|(a21?4:0)|(a22?8:0)|(a31?16:0)|(a32?32:0)|(a41?64:0)|(a42?128:0)|(a51?256:0)|(a52?512:0)|(a61?1024:0)|(a62?2048:0)|(a71?4096:0)|(a72?8192:0)|(a81?1<<14:0)|(a82?1<<15:0)|(a91?1<<16:0)|(a92?1<<17:0)|(a101?1<<18:0)|(a102?1<<19:0)|(a111?1<<20:0)|(a112?1<<21:0)|(a121?1<<22:0)|(a122?1<<23:0)|(a131?1<<24:0)|(a132?1<<25:0)|(a141?1<<26:0)|(a142?1<<27:0)
    }
    function sub() {
      var tktno = $('#tktno').val();
      var userid = document.getElementById('userid').value;
      var ad = document.getElementById('sel_ad').checked;
      var p = to_bool($('#sel1').val());
      var red2blue = $("#sel_red2blue").prop("checked");
      var guide_needed = $("#sel_guide_needed").prop("checked");
      var recent = to_bool($('#sel2').val());
      var score = parseInt($('#sel3').val());
      var papertype = parseInt($('#sel4').val());
      var tktdate = document.getElementById('tktdate').value;
      var recdate = document.getElementById('recdate').value;
      var tktdesc = document.getElementById('tktdesc').value;
      if (typeof (score) != "number") score = 0;
      var pj = "票质" + txt[score];
      if (typeof (ad) != "boolean") ad = false;
      if (p) score++;
      $('#scores').html('<p class="score mb-1">评分 Score: ' +
        score + ' 分<span class="bg-dark s' + score +
        'lt1">◉</span><span class="bg-dark s' + score +
        'lt2">◉</span></p>');
      var dicary = {
        "ad": ad,
        "date_log": [today],
        "date_rec": recdate,
        "date_tkt": tktdate,
        "memo": (p ? "红票," : "") + pj + "(" + tktdate + "," + userid + ")",
        "origin": userid,
        "papertype": papertype,
        "recent": recent,
        "red": p,
        "remove": $("#sel_rem").prop("checked"),
        "score": score
      };
      if (guide_needed) dicary.guide_needed = true;
      if (red2blue) dicary.red2blue = true;
      (papertype == 255) ? dicary.papertype = null : 0;
      var dic_text_arr = [];
      (ad ? dic_text_arr.push("票面广告") : 0);
      if ($("#descSel_pmbz").prop("checked")) {
        dicary.pmbz = $("#descSelTxt_pmbz").val();
      }
      var t = genFuncCode();
      if (t != 0) dicary.func=t;
      if (tktdesc != "") dic_text_arr.push(tktdesc);
      var dic_text = dic_text_arr.join();
      if (dic_text != "") dicary.text = dic_text;
      document.getElementById('jso').innerText = (tktno) ? ("(" + tktno + ",'" + $('#staname1').val() + " " + $('#staname2').val() + "','" + JSON.stringify([dicary]) + "',NULL)") : JSON.stringify(dicary);
    }
    function preset_date() {
      document.getElementById('tktdate').value = today;
      document.getElementById('recdate').value = today;
    }
    function sub_tkt(papertype) {
      var x = getTktType(papertype);
      $('#paper_example').html(x);
      $('#paper_example').fadeIn('fast');
      return x;
    }
  </script>
  <div class="container">
    <h2>票机数据收集表</h2>
    <p>注意：</p>
    <ol class="list-group">
      <li class="list-group-item list-group-item-info">首次填写前请阅读帮助页面，并与管理员取得联系，向管理员提交用户名注册申请。不被认可的用户名可能被要求修改或者以“热心网友”替代。</li>
      <li class="list-group-item">现在表格具有自动填写机器名的功能，填写时请按照先上后下的顺序。需要手动触发填写时，可以清空机器名一栏。</li>
      <li class="list-group-item list-group-item-info">据悉，记账日期晚于2021-04-03之车票不再显示“**售”，而直接显示“**”（车站名等）。自2021-04-03T00:00+08:00始至2021-05-03T00:00+08:00止，所有车票均需标注票号后注。</li>
    </ol>
    <form class="was-validated" action="javascript:sub()" onchange="sub()">
      <div class="form-group">
        <label for="userid">用户名：</label>
        <input type="text" class="form-control" id="userid" placeholder="热心网友" required size="10" maxlength="10"
          title="请输入合法的用户名。">
      </div>
      <div class="form-group">
        <label for="tktno">票号前十位:</label>
        <input type="text" class="form-control" id="tktno" placeholder="1001000033" pattern="[1-9]\d{9}" required
          size="10" maxlength="10" title="请输入十位数字。">
      </div>
      <div class="form-row">
        <div class="col">
          <label for="tktdate">取票日期:<span class="text-muted">取出车票的日期，用于确定票机状态。</span></label>
          <input type="date" class="form-control" id="tktdate" required title="请输入车票的取票日期。">
        </div>
        <div class="col">
          <label for="recdate">记录日期:<span class="text-muted">拍摄照片或查看车票的日期，用于确定车票状态。</span></label>
          <input type="date" class="form-control" id="recdate" required title="请输入照片拍摄或查看车票的日期，用于确定车票状态。">
        </div>
      </div>
      <div class="form-group">
        <label for="staname1">车站地点描述:</label>
        <div class="form-row">
          <div class="col-5">
            <div class="input-group mb-3">
              <input type="text" class="form-control" required size="14" id="staname1" placeholder="北京南">
              <div class="input-group-append">
                <span class="input-group-text">站</span>
              </div>
            </div>
          </div>
          <div class="col-7">
            <input type="text" class="form-control" required size="14" id="staname2" placeholder="候车室西南侧银通卡窗口">
          </div>
        </div>

      </div>
      <div class="form-check-inline">
        <label class="form-check-label">
          <input type="checkbox" class="form-check-input" id="sel_ad">有票面广告
        </label>
      </div>
      <div class="form-check-inline">
        <label class="form-check-label">
          <input type="checkbox" class="form-check-input" id="sel_rem">票机被移除
        </label>
      </div>
      <div class="form-check-inline">
        <label class="form-check-label">
          <input type="checkbox" class="form-check-input" id="sel_red2blue">红票改蓝票
        </label>
      </div>
      <div class="form-check-inline">
        <label class="form-check-label">
          <input type="checkbox" class="form-check-input" id="sel_guide_needed">终端号与机器贴纸不符
        </label>
      </div>
      <div class="form-group form-row">
        <div class="col">
          <label for="sel1">是否红票</label>
          <select class="form-control" id="sel1">
            <option value="true">红票</option>
            <option value="false" selected>蓝票</option>
            <option value="null">其他</option>
          </select>
        </div>
        <div class="col">
          <label for="sel2">时效性</label>
          <select class="form-control" id="sel2">
            <option value="true" selected>新鲜记录，仍然有效</option>
            <option value="null">未知</option>
            <option value="false">已经无效或超过两年</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="sel3">票质:</label>
        <select class="form-control" id="sel3">
          <option value="0">0分/极差：半年左右即模糊不清，并有缺失、白条等</option>
          <option value="1">1分/很差：一年左右即模糊不清，缺失、白条等</option>
          <option value="2" selected>2分/一般(略差)：略有模糊，略有不整齐</option>
          <option value="3">3分/尚可：半年左右仍清晰可认，无白条</option>
          <option value="4">4分/佳：一年仍清晰锐利，无白条、缺失</option>
        </select>
      </div>
      <div class="form-group">
        <label for="sel4">背面票纸:（检查背面“乘车须知”的字体）</label>
        <select class="form-control" id="sel4">
          <option value="1" data-red="0">蓝票黑体字（空两格）票纸</option>
          <option value="2" data-red="0">蓝票宋体字（左对齐）票纸</option>
          <option value="3" data-red="0">蓝票黑体字（左对齐）票纸</option>
          <option value="10" data-red="0">蓝票黑体字（其他）票纸</option>
          <option value="102" data-red="0">蓝票宋体字（居中）票纸</option>
          <option value="103" data-red="0">蓝票宋体字（左对齐，旧版1）票纸</option>
          <option value="200" data-red="0">蓝票宋体字（其他）票纸</option>
          <option value="19" data-red="0">不明蓝票票纸</option>
          <option value="21" data-red="1">红票宋体空两格票纸</option>
          <option value="22" data-red="1">第1类红票黑体左对齐票纸</option>
          <option value="23" data-red="1">第2类红票黑体左对齐票纸</option>
          <option value="24" data-red="1">第3类红票黑体左对齐票纸</option>
          <option value="59" data-red="1">不明红票票纸</option>
          <option value="255" data-red="2" selected>未知票纸</option>
        </select>
      </div>
      <div class="form-group">
        <p class="mb-1">票纸：<span id="paper_example"></span></p>
      </div>
      <div class="form-group" id="scores"></div>
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <div class="input-group-text">
            <input type="checkbox" aria-label="是否显示车票票号后的提示，复选框" id="descSel_pmbz">
          </div>
          <span class="input-group-text">票号后注</span>
        </div>
        <input type="text" class="form-control" id="descSelTxt_pmbz" aria-label="请输入车票票号后的提示" placeholder="武A售"
          title="请输入车票票号后的提示。">
      </div>
      <div class="form-group">
        <small class="text-muted">如有“武A售”“上海自售”等特殊字样应该填写上框。</small>
      </div>
      <div class="form-group">
        票机功能信息:
        <span class="text-danger">本栏目尚未开放，如不确定请先不要填写</span>
        <table class="table">
          <tr>
            <th>取报销凭证</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_11">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_12">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>行程信息单</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_21">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_22">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>会员服务</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_31">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_32">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>购票</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_41">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_42">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>支持现金</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_51">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_52">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>支持银行卡</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_61">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_62">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>支持电子支付</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_71">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_72">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>支持护照读取</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_81">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_82">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>优惠资质绑定</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_91">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_92">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>信息查询</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_101">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_102">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>取电话订票</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_111">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_112">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>退票</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_121">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_122">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>已取报销凭证的退票</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_131">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_132">具有该功能
              </label>
            </td>
          </tr>
          <tr>
            <th>银通卡、e卡通换票</th>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_141">确定
              </label>
            </td>
            <td>
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" id="sel_142">具有该功能
              </label>
            </td>
          </tr>
        </table>
      </div>
      <div class="form-group">
        <label for="tktdesc">其他描述:</label>
        <input type="text" class="form-control" id="tktdesc" placeholder="票面广告，背面字体等" size="100" maxlength="100" title="请输入对车票的其他描述。">
      </div>
      <button type="reset" class="btn btn-warning" onclick="preset_date()">清空</button>
      <button type="submit" class="btn btn-primary">生成代码</button>
      <div class="form-group">
        <label for="jso">请将以下代码 <strong>复制</strong> 给管理员：</label>
        <textarea class="form-control" rows="5" id="jso" readonly></textarea>
      </div>
    </form>
  </div>
</body>

</html>
