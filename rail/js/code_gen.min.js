var today=new Date;today=today.toISOString().split("T")[0];var tktscore=["0分/极差：半年左右即模糊不清，并有缺失、白条等","1分/很差：一年左右即模糊不清，缺失、白条等","2分/一般(略差)：略有模糊，略有不整齐","3分/尚可：半年左右仍清晰可认，无白条","4分/佳：一年仍清晰锐利，无白条、缺失"],funD=["取报销凭证","行程信息单","会员服务","购票","支持现金","支持银行卡","支持电子支付","支持护照读取","优惠资质绑定","信息查询","取电话订票","退票","已取报销凭证的退票","便捷乘车换票","计次/定期票","改签","联系方式预留/变更",'英语服务 <span lang="en">English Service</span>',"免费乘车儿童申明"];function gHtm(){$("table#tab-func").append(funD.map((function(e,t){return"<tr><th>"+e+'</th><td><label class="form-check-label"><input type="checkbox" class="form-check-input" id="sel_'+(t+1)+'1">确定</label></td><td><label class="form-check-label"><input type="checkbox" class="form-check-input" id="sel_'+(t+1)+'2">具有该功能</label></td></tr>'}))),$("#tktdate").val(today),$("#recdate").val(today)}function to_bool(val){var p=eval(val);return"boolean"!=typeof p&&(p=null),p}function genFuncCode(){var e=0,t=0;for(i=1;i<16;++i)e|=($("#sel_"+i+"1").prop("checked")?1<<(i<<1)-2:0)|($("#sel_"+i+"2").prop("checked")?1<<(i<<1)-1:0);for(i=0;i<4;++i)t|=($("#sel_"+(i+16)+"1").prop("checked")?1<<(i<<1):0)|($("#sel_"+(i+16)+"2").prop("checked")?1<<1+(i<<1):0);return[e,t]}function sub(){var e=$("#tktno").val(),t=document.getElementById("userid").value,a=document.getElementById("selAd").checked?1:0,n=parseInt($("#sel1").val()),l=parseInt($("#sel2").val()),r=parseInt($("#sel3").val()),c=parseInt($("#sel4").val()),s=$("#tktdate").val(),o=$("#recdate").val(),d=parseInt($("#machbrandSel").val()),p=$("#machbrandTxt").val(),i=$("#tktdesc").val(),u=$("#tktfullnum").val();"number"!=typeof r&&(r=0),1==n&&r++,$("#scores").html('<p class="score mb-1">评分 Score: '+r+' 分<span class="bg-dark s'+r+'lt1">◉</span><span class="bg-dark s'+r+'lt2">◉</span></p>');var h={ad:a,whenLog:today,whenRec:o,whenTkt:s,origin:t,recent:l,score:r};2!=n&&(h.red=n),$("#sel_rem").prop("checked")&&(h.remove=1),$("#sel_guide_needed").prop("checked")&&(h.NeedGuide=1),$("#sel_red2blue").prop("checked")&&(h.red2blue=1),255!=c&&(h.PaperT=c);var v=[];$("#descSel_pmbz").prop("checked")&&(h.pmbz=$("#descSelTxt_pmbz").val()),a&&(h.adTxt=$("#selAdTxt").val());var m=genFuncCode();0==m[0]&&0==m[1]||(h.func=m),""!=u&&(h.tktid=u),""!=i&&v.push(i);var b=v.join();""!=b&&(h.text=b),0!=d?h.brand=d:""!=p&&(h.brand=p);var f=e?"("+e+",'"+$("#staname1").val()+" "+$("#staname2").val()+"','"+JSON.stringify([h])+"',NULL)":JSON.stringify(h);return document.getElementById("jso").innerText=f,f}function sub2(e){(async()=>{var t=$(e);try{t.on("hidden.bs.tooltip",(()=>t.tooltip("disable"))),await navigator.clipboard.writeText(sub()),t.tooltip({title:"复制成功！",trigger:"focus"}).tooltip("enable").tooltip("show")}catch(e){}})()}function sub_tkt(e){var t=getTktType(e);return $("#paper_example").html(t),$("#paper_example").fadeIn("fast"),t}$(document).ready((function(){gHtm(),$("#staname1").change((function(){var e=$("#staname1").val();e.length>0&&$("#descSelTxt_pmbz").attr("placeholder","例如："+e)})),$("#staname2").change((function(){var e=$("#staname2").attr("placeholder");e.length>0&&0==$("#staname2").val().length&&$("#staname2").val(e)})),$("#tktno").change((function(){var e=parseInt($("#tktno").val())%1e5;if(e>0){var t=e>=3e4?(e/1e3%100).toFixed().toString()+"-"+(e%1e3).toFixed().toString()+"号?取票机":e<1e4?(e%1e3).toFixed().toString()+"号?窗口":"代售点?";$("#staname2").attr("placeholder",t),t.length>0&&0==$("#staname2").val().length&&$("#staname2").val(t)}})),$("#descSelTxt_pmbz").change((function(){$("#descSel_pmbz").prop("checked",Boolean($("#descSelTxt_pmbz").val()))})),$("#selAdTxt").change((function(){$("#selAd").prop("checked",Boolean($("#selAdTxt").val()))})),$("#sel1").change((function(){var e=parseInt($("#sel1").val()),t=$("#sel4").children();t.attr("disabled",!1);for(var a=0;a<t.length;++a){var n=$(t[a]),l=parseInt(n.data("red"));2!=l&&e!=l?n.hide():n.show()}})).change(),$("#sel3").change((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})).change(),$("#sel3").mousemove((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})),$("#sel4").change((function(){$("#paper_example").fadeOut("fast",(function(){sub_tkt(parseInt($("#sel4").val()))}))})),$("#btn-clear-func").click((function(){return $("#tab-func").find("input").prop("checked",!1),sub(),!1})),$("#machbrandSel").change((function(){$("#machbrandTxt").attr("disabled",0!=parseInt($("#machbrandSel").val()))}))}));