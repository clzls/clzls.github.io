var today=new Date;today=today.toISOString().split("T")[0];var tktscore=["0分/极差：半年左右即模糊不清，并有缺失、白条等","1分/很差：一年左右即模糊不清，缺失、白条等","2分/一般(略差)：略有模糊，略有不整齐","3分/尚可：半年左右仍清晰可认，无白条","4分/佳：一年仍清晰锐利，无白条、缺失"];function to_bool(val){var p=eval(val);return"boolean"!=typeof p&&(p=null),p}function genFuncCode(){var e=0,t=0;for(i=1;i<16;++i)e|=($("#sel_"+i+"1").prop("checked")?1<<(i<<1)-2:0)|($("#sel_"+i+"2").prop("checked")?1<<(i<<1)-1:0);for(i=0;i<3;++i)t|=($("#sel_"+(i+16)+"1").prop("checked")?1<<(i<<1):0)|($("#sel_"+(i+16)+"2").prop("checked")?1<<1+(i<<1):0);return[e,t]}function sub(){var e=$("#tktno").val(),t=document.getElementById("userid").value,a=document.getElementById("sel_ad").checked?1:0,n=parseInt($("#sel1").val()),r=parseInt($("#sel2").val()),l=parseInt($("#sel3").val()),c=parseInt($("#sel4").val()),s=$("#tktdate").val(),o=$("#recdate").val(),d=parseInt($("#machbrandSel").val()),p=$("#machbrandTxt").val(),i=$("#tktdesc").val(),u=$("#tktfullnum").val();"number"!=typeof l&&(l=0),1==n&&l++,$("#scores").html('<p class="score mb-1">评分 Score: '+l+' 分<span class="bg-dark s'+l+'lt1">◉</span><span class="bg-dark s'+l+'lt2">◉</span></p>');var v={PaperT:c,ad:a,whenLog:today,whenRec:o,whenTkt:s,origin:t,recent:r,score:l};2!=n&&(v.red=n),$("#sel_rem").prop("checked")&&(v.remove=1),$("#sel_guide_needed").prop("checked")&&(v.NeedGuide=1),$("#sel_red2blue").prop("checked")&&(v.red2blue=1),255==c&&(v.PaperT=null);var h=[];a&&h.push("票面广告"),$("#descSel_pmbz").prop("checked")&&(v.pmbz=$("#descSelTxt_pmbz").val());var m=genFuncCode();0==m[0]&&0==m[1]||(v.func=m),""!=u&&(v.tktid=u),""!=i&&h.push(i);var g=h.join();""!=g&&(v.text=g),0!=d?v.brand=d:""!=p&&(v.brand=p);var f=e?"("+e+",'"+$("#staname1").val()+" "+$("#staname2").val()+"','"+JSON.stringify([v])+"',NULL)":JSON.stringify(v);return document.getElementById("jso").innerText=f,f}function sub2(){(async()=>{try{await navigator.clipboard.writeText(sub())}catch(e){}})()}function preset_date(){document.getElementById("tktdate").value=today,document.getElementById("recdate").value=today}function sub_tkt(e){var t=getTktType(e);return $("#paper_example").html(t),$("#paper_example").fadeIn("fast"),t}$(document).ready((function(){preset_date(),$("#staname1").change((function(){var e=$("#staname1").val();e.length>0&&($("#descSelTxt_pmbz").prop("placeholder","例如："+e),$("#descSelTxt_pmbz").attr("placeholder","例如："+e))})),$("#staname2").change((function(){var e=$("#staname2").prop("placeholder");e.length>0&&0==$("#staname2").val().length&&$("#staname2").val(e)})),$("#tktno").change((function(){var e=parseInt($("#tktno").val())%1e5;if(e>0){var t=e>=3e4?(e/1e3%100).toFixed().toString()+"-"+(e%1e3).toFixed().toString()+"号?取票机":e<1e4?(e%1e3).toFixed().toString()+"号?窗口":"代售点?";$("#staname2").prop("placeholder",t),t.length>0&&0==$("#staname2").val().length&&$("#staname2").val(t)}})),$("#descSelTxt_pmbz").change((function(){$("#descSel_pmbz").prop("checked",Boolean($("#descSelTxt_pmbz").val()))})),$("#sel1").change((function(){var e=parseInt($("#sel1").val()),t=$("#sel4").children();t.attr("disabled",!1);for(var a=0;a<t.length;++a){var n=$(t[a]);e!=parseInt(n.attr("data-red"))?n.hide():n.show()}})).change(),$("#sel3").change((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})).change(),$("#sel3").mousemove((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})),$("#sel4").change((function(){$("#paper_example").fadeOut("fast",(function(){sub_tkt(parseInt($("#sel4").val()))}))})),$("#btn-clear-func").click((function(){return $("#tab-func").find("input").prop("checked",!1),sub(),!1})),$("#machbrandSel").change((function(){$("#machbrandTxt").attr("disabled",0!=parseInt($("#machbrandSel").val()))}))}));