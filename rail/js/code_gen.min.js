var today=new Date;today=today.toISOString().split("T")[0];var txt=["极差","很差","略差","尚可","佳"],tktscore=["0分/极差：半年左右即模糊不清，并有缺失、白条等","1分/很差：一年左右即模糊不清，缺失、白条等","2分/一般(略差)：略有模糊，略有不整齐","3分/尚可：半年左右仍清晰可认，无白条","4分/佳：一年仍清晰锐利，无白条、缺失"];function to_bool(val){var p=eval(val);return"boolean"!=typeof p&&(p=null),p}function genFuncCode(){var ans=0,ans2=0;for(i=1;i<16;++i)ans|=($("#sel_"+i+"1").prop("checked")?1<<(i<<1)-2:0)|($("#sel_"+i+"2").prop("checked")?1<<(i<<1)-1:0);for(i=0;i<3;++i)ans2|=($("#sel_"+(i+16)+"1").prop("checked")?1<<(i<<1):0)|($("#sel_"+(i+16)+"2").prop("checked")?1<<1+(i<<1):0);return[ans,ans2]}function sub(){var tktno=$("#tktno").val(),userid=document.getElementById("userid").value,ad=document.getElementById("sel_ad").checked?1:0,p=parseInt($("#sel1").val()),recent=parseInt($("#sel2").val()),score=parseInt($("#sel3").val()),papert=parseInt($("#sel4").val()),tktdate=$("#tktdate").val(),recdate=$("#recdate").val(),tktdesc=$("#tktdesc").val(),tktfullnum=$("#tktfullnum").val();"number"!=typeof score&&(score=0),1==p&&score++,$("#scores").html('<p class="score mb-1">评分 Score: '+score+' 分<span class="bg-dark s'+score+'lt1">◉</span><span class="bg-dark s'+score+'lt2">◉</span></p>');var dicary={PaperT:papert,ad:ad,date_log:today,date_rec:recdate,date_tkt:tktdate,origin:userid,recent:recent,score:score};2!=p&&(dicary.red=p),$("#sel_rem").prop("checked")&&(dicary.remove=1),$("#sel_guide_needed").prop("checked")&&(dicary.NeedGuide=1),$("#sel_red2blue").prop("checked")&&(dicary.red2blue=1),255==papert&&(dicary.PaperT=null);var dic_text_arr=[];ad&&dic_text_arr.push("票面广告"),$("#descSel_pmbz").prop("checked")&&(dicary.pmbz=$("#descSelTxt_pmbz").val());var t=genFuncCode();0==t[0]&&0==t[1]||(dicary.func=t),""!=tktfullnum&&(dicary.tktid=tktfullnum),""!=tktdesc&&dic_text_arr.push(tktdesc);var dic_text=dic_text_arr.join();""!=dic_text&&(dicary.text=dic_text);var txt=tktno?"("+tktno+",'"+$("#staname1").val()+" "+$("#staname2").val()+"','"+JSON.stringify([dicary])+"',NULL)":JSON.stringify(dicary);return document.getElementById("jso").innerText=txt,txt}function sub2(){(async()=>{try{await navigator.clipboard.writeText(sub()),console.log("Copied to clipboard")}catch(err){console.error("Failed to copy: ",err)}})()}function preset_date(){document.getElementById("tktdate").value=today,document.getElementById("recdate").value=today}function sub_tkt(papertype){var x=getTktType(papertype);return $("#paper_example").html(x),$("#paper_example").fadeIn("fast"),x}$(document).ready((function(){preset_date(),$("#staname1").change((function(){var t=$("#staname1").val();t.length>0&&($("#descSelTxt_pmbz").prop("placeholder","例如："+t),$("#descSelTxt_pmbz").attr("placeholder","例如："+t))})),$("#staname2").change((function(){var t=$("#staname2").prop("placeholder");t.length>0&&0==$("#staname2").val().length&&$("#staname2").val(t)})),$("#tktno").change((function(){var t=parseInt($("#tktno").val())%1e5;if(t>0){var msg=t>=3e4?(t/1e3%100).toFixed().toString()+"-"+(t%1e3).toFixed().toString()+"号?取票机":t<1e4?(t%1e3).toFixed().toString()+"号?窗口":"代售点?";$("#staname2").prop("placeholder",msg),msg.length>0&&0==$("#staname2").val().length&&$("#staname2").val(msg)}})),$("#descSelTxt_pmbz").change((function(){$("#descSel_pmbz").prop("checked",Boolean($("#descSelTxt_pmbz").val()))})),$("#sel1").change((function(){var t=parseInt($("#sel1").val()),k=$("#sel4").children();k.attr("disabled",!1);for(var i=0;i<k.length;++i){var tp=$(k[i]),tpv;t!=parseInt(tp.attr("data-red"))?tp.hide():tp.show()}})).change(),$("#sel3").change((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})).change(),$("#sel3").mousemove((function(){$("#sel3resl").text(tktscore[parseInt($("#sel3").val())])})),$("#sel4").change((function(){$("#paper_example").fadeOut("fast",(function(){sub_tkt(parseInt($("#sel4").val()))}))})),$("#btn-clear-func").click((function(){return $("#tab-func").find("input").prop("checked",!1),sub(),!1}))}));