var today=(new Date).toISOString().split("T")[0],tktscore=["0分/极差：半年左右即模糊不清，并有缺失、白条等","1分/很差：一年左右即模糊不清，缺失、白条等","2分/一般(略差)：略有模糊，略有不整齐","3分/尚可：半年左右仍清晰可认，无白条","4分/佳：一年仍清晰锐利，无白条、缺失"],funD=["取报销凭证","行程信息单","会员服务","购票","支持现金","支持银行卡","支持电子支付","支持护照读取","优惠资质绑定","信息查询","取电话订票","退票","已取报销凭证的退票","便捷乘车换票","计次/定期票","改签","联系方式预留/变更",'英语服务 <span lang="en">English Service</span>',"添加免费乘车儿童"];function gi(e){return document.getElementById(e)}function gj(e){return parseInt(gi(e).value)}function gb(e){return Boolean(gi(e).value)}function gHtm(){var e=document.querySelector("table#tab-func tbody");funD.forEach((function(n,t){var a=document.createElement("tr");a.innerHTML='<th scope="row">'+n+'</th><td><input type="checkbox" class="form-check-input" id="sel_'+(t+1)+'1"> <label class="form-check-label" for="sel_'+(t+1)+'1">确定</label></td><td><input type="checkbox" class="form-check-input" id="sel_'+(t+1)+'2"> <label class="form-check-label" for="sel_'+(t+1)+'2">具有该功能</label></td>',e.appendChild(a)})),gi("tktdate").value=today,gi("recdate").value=today}function genFuncCode(){var e=0,n=0;for(i=1;i<16;++i)e|=(gi("sel_"+i+"1").checked?1<<(i<<1)-2:0)|(gi("sel_"+i+"2").checked?1<<(i<<1)-1:0);for(i=0;i<4;++i)n|=(gi("sel_"+(i+16)+"1").checked?1<<(i<<1):0)|(gi("sel_"+(i+16)+"2").checked?1<<1+(i<<1):0);return[e,n]}function sub(e){e&&e.preventDefault();var n=gi("tktno").value,t=gi("userid").value,a=gi("selAd").checked?1:0,i=gj("sel1"),c=gj("sel2"),l=gj("sel3"),o=gj("sel4"),s=gi("tktdate").value,d=gi("recdate").value,r=gj("machbrandSel"),u=gi("machbrandTxt").value,g=gi("tktdesc").value,f=gi("tktfullnum").value,b=gi("selAddr").value,p=gi("selOpenHour").value,h=genFuncCode();"number"!=typeof l&&(l=0),1==i&&l++,gi("scores").innerHTML='<p class="score">评分 Score: '+l+' 分 <span class="bg-dark s'+l+'lt1">◉</span><span class="bg-dark s'+l+'lt2">◉</span></p>';var m={ad:a,origin:t,recent:c,score:l,whenLog:today,whenRec:d,whenTkt:s};2!=i&&(m.red=i),gi("sel_rem").checked&&(m.remove=1),gi("sel_guide_needed").checked&&(m.NeedGuide=1),gi("sel_red2blue").checked&&(m.red2blue=1),255!=o&&(m.PaperT=o),gi("descSel_pmbz").checked&&(m.pmbz=gi("descSelTxt_pmbz").value),a&&(m.adTxt=gi("selAdTxt").value),(h[0]||h[1])&&(m.func=h),""!=f&&(m.tktid=f),""!=b&&(m.addr=b),""!=p&&(m.openHour=p),""!=g&&(m.text=g),0!=r?m.brand=r:""!=u&&(m.brand=u);var k=n?"("+n+",'"+gi("staname1").value+" "+gi("staname2").value+"','"+JSON.stringify([m])+"',NULL),":JSON.stringify(m);return gi("jso").innerText=k,k}function sub_tkt(e){var n=getTktType(e);return $("#paper_example").html(n),$("#paper_example").fadeIn("fast"),n}function sub3(e){e?setTimeout(sub3,10):(gi("tktdate").value=today,gi("recdate").value=today,"function"==typeof lockUsrId&&gi("btn-lock-userid").onclick(114))}document.addEventListener("DOMContentLoaded",(function(){gHtm(),document.forms[0].onsubmit=document.forms[0].onchange=sub,document.forms[0].onreset=sub3,gi("staname2").onchange=function(){var e=gi("staname2").placeholder;e.length>0&&0==gi("staname2").value.length&&(gi("staname2").value=e)},gi("tktno").onchange=function(){var e=gj("tktno")%1e5,n=gi("staname2");if(e>0){var t=e>=3e4?(e/1e3%100).toFixed()+"-"+(e%1e3).toFixed()+"号?取票机":e<1e4?(e%1e3).toFixed()+"号?窗口":"代售点?";n.placeholder=t,t.length>0&&0==n.value.length&&(n.value=t)}},gi("descSelTxt_pmbz").onchange=function(){gi("descSel_pmbz").checked=gb("descSelTxt_pmbz")},gi("selAdTxt").onchange=function(){gi("selAd").checked=gb("selAdTxt")},(gi("sel1").onchange=function(){for(var e=gj("sel1"),n=gi("sel4").children,t=0;t<n.length;++t){var a=n[t],i=parseInt(a.dataset.red);a.hidden=2!=i&&e!=i}})(),(gi("sel3").onmousemove=gi("sel3").onchange=function(){gi("sel3resl").innerText=tktscore[gj("sel3")]})(),gi("sel4").onchange=function(){$("#paper_example").fadeOut("fast",(function(){sub_tkt(gj("sel4"))}))},gi("btn-clear-func").onclick=function(){$("#tab-func").find("input").prop("checked",!1),sub()},gi("machbrandSel").onchange=function(){gi("machbrandTxt").disabled=0!=gj("machbrandSel")},"function"==typeof sub2?gi("btn-copy").onclick=sub2:gi("btn-copy").disabled=!0;var e=gi("btn-lock-userid");"function"==typeof lockUsrId?(e.onclick=lockUsrId,e.onclick(114)):e.disabled=!0}));